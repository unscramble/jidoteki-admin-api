/*
  This Source Code Form is subject to the terms of the Mozilla Public
  License, v. 2.0. If a copy of the MPL was not distributed with this
  file, You can obtain one at http://mozilla.org/MPL/2.0/.

  Copyright (c) 2015-2017 Alexander Williams, Unscramble <license@unscramble.jp>
 */

(function(){"use strict";var e,t,a,r,o,n,i,s,l,d,p,c,u,g,v,b,f,k,h,m,j,w,y,C,I,_,P,A,T,D,S,x,F,q,N,E,O,H,M,Q,W,R,B,L,G,J,z,U,K,V,X,Y,Z=[].indexOf||function(e){for(var t=0,a=this.length;a>t;t++)if(t in this&&this[t]===e)return t;return-1};t=null!=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(null!=window.location.port?":"+window.location.port:""),M=function(e){var t,a,r;return $("#login-remember").is(":checked")?(t=new Date,r=864e5,a=30,t.setTime(+t+a*r),document.cookie="jidoteki-admin-api-token="+e+"; expires="+t.toGMTString()+"; path=/"):document.cookie="jidoteki-admin-api-token="+e+"; path=/"},f=function(){return(document.cookie.match("(^|; )jidoteki-admin-api-token=([^;]*)")||0)[2]},s=function(){return document.cookie="jidoteki-admin-api-token=; path=/"},n=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},v=function(e){var t;return t=forge.md.sha256.create(),t.update(e),t.digest().toHex()},g=function(e,t){var a;return a=forge.hmac.create(),a.start("sha256",t),a.update(e),a.digest().toHex()},c=function(e,a){var r,o;return o=f(),null!=o?(r=g("GET"+e,o),$.ajaxSetup({headers:{"Auth-Hash":r}}),$.get(""+t+e).done(function(e){return a(null,e)}).fail(function(e){return a(new Error(e))})):a(new Error("Missing or invalid API token"))},u=function(e,a){var r,o;return o=f(),null!=o?(r=g("GET"+e,o),$(location).attr("href",""+t+e+"?hash="+r)):a(new Error("Missing or invalid API token"))},H=function(e,a,r,o){var n,i;return i=f(),null!=i?(n=g("POST"+a,i),$(".jido-page-content-"+e+" .progress .progress-bar").removeClass("progress-bar-danger"),$(".jido-page-content-"+e+" .progress .progress-bar").removeClass("progress-bar-primary"),$(".jido-page-content-"+e+" .progress .progress-bar").addClass("progress-bar-striped"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("progress-bar-striped",33),$(".jido-page-content-"+e+" .progress .progress-bar").attr("aria-valuenow",33),$(".jido-page-content-"+e+" .progress .progress-bar").html("....uploading, please wait"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("style","width: 33%"),$(".jido-page-content-"+e+" .progress").show(),$.ajax({url:""+t+a,type:"POST",data:r,headers:{"Auth-Hash":n},processData:!1,contentType:!1,success:function(t,a,r){return G(e),o(null,t)},error:function(t,a,r){return p(e,"upload failed"),o(new Error(r),t)}})):o(new Error("Missing or invalid API token"))},G=function(e){return $(".jido-page-content-"+e+" .progress").show(),$(".jido-page-content-"+e+" .progress .progress-bar").addClass("progress-bar-primary"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("progress-bar-striped",66),$(".jido-page-content-"+e+" .progress .progress-bar").attr("aria-valuenow",66),$(".jido-page-content-"+e+" .progress .progress-bar").html("...updating"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("style","width: 66%")},U=function(e){return $(".jido-page-content-"+e+" .progress .progress-bar").removeClass("progress-bar-striped"),$(".jido-page-content-"+e+" .progress .progress-bar").addClass("progress-bar-success"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("aria-valuenow",100),$(".jido-page-content-"+e+" .progress .progress-bar").html("done"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("style","width: 100%"),$("."+e+"-form").show(),$("."+e+"-alert").hide()},p=function(e,t){return $(".jido-page-content-"+e+" .progress .progress-bar").removeClass("progress-bar-striped"),$(".jido-page-content-"+e+" .progress .progress-bar").addClass("progress-bar-danger"),$(".jido-page-content-"+e+" .progress .progress-bar").attr("aria-valuenow",100),$(".jido-page-content-"+e+" .progress .progress-bar").html(validator.escape(t)),$(".jido-page-content-"+e+" .progress .progress-bar").attr("style","width: 100%"),$("."+e+"-form").show(),$("."+e+"-alert").hide()},b=function(e,t){return c("/api/v1/"+a+"/"+e,function(a,r){var o,n;return a?t(new Error(a)):(n="object"==typeof r.status?"":validator.escape(r.status),$(".jido-data-"+e+"-status").html(n),r.log&&$(".jido-data-"+e+"-log").html("object"==typeof r.log?"No log file found":validator.escape(r.log).replace(/\\n/g,"<br/>")),o=function(){switch(n){case"failed":return"label-danger";case"success":return"label-success";case"running":return"label-primary";default:return $(".jido-data-"+e+"-status").html("waiting for "+e),"label-default"}}(),"failed"===n?($(".jido-page-content-"+e+" .alert.jido-panel").addClass("alert-danger"),$(".jido-page-content-"+e+" .jido-page-content-"+e+"-panel").attr("style","background-color: none")):($(".jido-page-content-"+e+" .alert.jido-panel").removeClass("alert-danger"),$(".jido-page-content-"+e+" .jido-page-content-"+e+"-panel").attr("style","background-color: #EEEEEE")),r["error-code"]&&r["error-message"]&&"failed"===n?($(".jido-data-"+e+"-status-error").show(),$(".jido-data-"+e+"-status-error-message").html(validator.escape(r["error-code"])+": "+validator.escape(r["error-message"]))):($(".jido-data-"+e+"-status-error").hide(),$(".jido-data-"+e+"-status-error-message").html("")),$(".jido-data-"+e+"-status").removeClass("label-danger"),$(".jido-data-"+e+"-status").removeClass("label-success"),$(".jido-data-"+e+"-status").removeClass("label-default"),$(".jido-data-"+e+"-status").addClass(o),t(r))})},O=function(e){var t;return $("."+e+"-form").hide(),$("."+e+"-alert").show(),t=setInterval(function(){return b(e,function(a){if("failed"===a.status)return clearInterval(t),p(e,"failed");if("success"===a.status){if(clearInterval(t),U(e),"backup"===e)return k()}else if("running"===a.status)return G(e)})},1e3)},Q=function(e){var t;return t=setInterval(function(){return clearInterval(t),$(location).attr("href",e)},5e3)},r=function(e){return c("/api/v1/admin/version",function(t,a){return t?(s(),e(t)):e(null)})},R=function(){return c("/api/v1/admin/health",function(e,t){var a,r,o;return e?void 0:(a=t.cpu.cpu5min>=t.cpu.num?"jido-health-danger":"",r=t.disk.percentage>=98?"jido-health-danger":"",o=t.memory.percentage>=90?"jido-health-danger":"",$("#jido-health-bar").empty(),$("#jido-health-bar").append('<li class="'+a+'">cpu '+t.cpu.load+" ("+t.cpu.num+" cores)</li>"),$("#jido-health-bar").append('<li class="'+r+'">disk '+t.disk.used+" of "+t.disk.total+" ("+t.disk.percentage+"%)</li>"),$("#jido-health-bar").append('<li class="'+o+'">memory '+t.memory.used+" of "+t.memory.total+" ("+t.memory.percentage+"%)</li>"))})},W=function(){return c("/api/v1/admin/endpoints",function(t,a){var r,o,n,i,s;if(!t){for(i=[],r=0,o=e.length;o>r;r++)s=e[r],n="/api/v1/admin/"+s,Z.call(a.endpoints,n)>=0?i.push($("#jido-button-"+s).show()):i.push(void 0);return i}})},P=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-token").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-token").show(),$(".jido-page-content-token .jido-panel-network").show(),$(".token-form .token-token1-label").focus(),$(".token-form input.form-control").val("")},C=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar").hide(),$("#jido-page-token").show(),$(".jido-page-content-token .jido-panel-network").show(),$(".token-form .token-token1-label").focus(),$(".token-form input.form-control").val("")},m=function(){return $(".jido-page-content").hide(),$("#jido-page-navbar").hide(),$("#jido-page-login").show(),$("#login-password").focus()},D=function(){return $("#jido-button-logout").click(function(){return s(),m()})},T=function(){return $("#jido-button-login").click(function(){var e,t;return e=$("#login-password").val(),e.length>=0&&e.length<=255&&(t=v(e)),null!=t?(M(t),r(function(e){return e?($("#invalid-token").show(),$("#login-password").focus()):($("#login-password").val(""),$("#invalid-token").hide(),h())})):($("#invalid-token").show(),$("#login-password").focus())})},E=function(){return $("#new-token").click(function(){return C()})},V=function(){return $("#jido-button-token-upload").click(function(){var e,t,a,r;return t=$("#token1-input").val(),a=$("#token2-input").val(),t?a?t!==a?($(".token-alert").html("API Token mismatch. Please verify the API Token."),void $(".token-alert").show()):(t.length>0&&t.length<=255&&(r=v(t)),null==r?($(".token-alert").html("Invalid API Token. Must be between 1 and 255 characters"),$(".token-alert").show(),$(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),$(".token-form .token-token2-label").parent().addClass("has-error"),$(".token-form .token-token2-label").html("Confirm API Token (required)"),void $(".token-form .token-token1-label").focus()):(e=new FormData,e.append("newtoken",t),e?H("token","/api/v1/admin/setup",e,function(e,t){return e?($(".jido-data-token-status").html("failed"),$(".jido-data-token-status").removeClass("label-danger"),$(".jido-data-token-status").removeClass("label-success"),$(".jido-data-token-status").removeClass("label-default"),$(".jido-data-token-status").addClass("label-danger"),p("token")):($(".jido-data-token-status").html("changed"),$(".jido-data-token-status").removeClass("label-danger"),$(".jido-data-token-status").removeClass("label-success"),$(".jido-data-token-status").removeClass("label-default"),$(".jido-data-token-status").addClass("label-success"),$(".token-alert").hide(),M(r),U("token"),$("#token1-input").val(""),$("#token2-input").val(""),$(".jido-page-content-token .jido-panel-network").hide(),P())}):void 0)):($(".token-form .token-token2-label").parent().addClass("has-error"),$(".token-form .token-token2-label").html("Confirm API Token (required)"),void $(".token-form .token-token2-label").focus()):($(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus())})},D(),T(),E(),V(),a="admin",e=["settings","certs","license","storage","backup","replication"],h=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-home").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-dashboard").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),R(),W(),c("/api/v1/admin/settings",function(e,t){var a,r,o;return e?void 0:(r=function(){var e,r;e=t.network,r=[];for(a in e)o=e[a],"ip_address"===a&&(a="IP address"),"dns1"===a&&(a="DNS 1"),"dns2"===a&&(a="DNS 2"),"ntpserver"===a&&(a="NTP Server"),"object"==typeof o&&(o=""),r.push('<li class="list-group-item">'+n(a)+' <span class="pull-right text-primary">'+validator.escape(o)+"</span></li>");return r}(),$(".jido-data-network-info").html(r))}),c("/api/v1/admin/changelog",function(e,t){return e?void 0:$(".jido-data-changelog").html(validator.escape(t))}),c("/api/v1/admin/services",function(e,t){var a,r,o,n,i,s,l;if(!e){for(s="",n=t.services,a=0,o=n.length;o>a;a++){i=n[a];for(r in i)l=i[r],s+="running"===l?'<li class="list-group-item"><i class="fa icon-ok-circled text-success"></i> '+validator.escape(r)+' <span class="pull-right text-success">'+validator.escape(l)+"</span></li>":'<li class="list-group-item"><i class="fa icon-cancel-circled text-danger"></i> '+validator.escape(r)+' <span class="pull-right text-danger">'+validator.escape(l)+"</span></li>"}return $(".jido-data-services-info").html(s)}})},A=function(e){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-"+e).addClass("active"),$("#jido-page-navbar").show(),$(".jido-page-content-"+e).show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),b(e,function(t){return"running"===t.status?O(e):void 0})},w=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-settings").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-network").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),c("/api/v1/admin/settings",function(e,t){var a,r,o;return e?void 0:($(".network-form input.form-control").val(""),null==t.network["interface"]&&$("#interface-input").val("eth0"),r=function(){var e,r;e=t.network,r=[];for(a in e)o=e[a],"object"==typeof o&&(o=""),$("#"+a+"-input").val(validator.escape(o)),r.push('<li class="list-group-item">'+n(a)+' <span class="pull-right label label-primary">'+validator.escape(o)+"</span></li>");return r}(),$(".jido-data-network-info").html(r))})},I=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-storage").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-storage").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),c("/api/v1/admin/storage",function(e,t){var a,r,o;if(!e){if($(".storage-form input.form-control").val(""),r=function(){var e,a,r,n;for(r=t.options,n=[],e=0,a=r.length;a>e;e++)switch(o=r[e],$("#storage-help-"+o).show(),o){case"local":n.push("<option value='local')>Local (disk)</option>");break;case"nfs":n.push("<option value='nfs'>NFS</option>");break;case"aoe":n.push("<option value='aoe'>AoE (ATA-over-Ethernet)</option>");break;case"iscsi":n.push("<option value='iscsi'>iSCSI</option>");break;case"nbd":n.push("<option value='nbd'>NBD</option>");break;default:n.push(void 0)}return n}(),$("#storage-name-select").html(r),!(t.storage.type&&(a=t.storage.type,Z.call(t.options,a)>=0)))return $("#storage-name-select option[value=local]").attr("selected",!0);switch($("#storage-name-select option[value="+t.storage.type+"]").attr("selected",!0),$("#storage-"+t.storage.type).show(),t.storage.type){case"nfs":return $("#storage-"+t.storage.type+" .mount-input").val(validator.escape(t.storage.mount_options)),$("#storage-"+t.storage.type+" .ip-input").val(validator.escape(t.storage.ip)),$("#storage-"+t.storage.type+" .share-input").val(validator.escape(t.storage.share));case"aoe":return $("#storage-"+t.storage.type+" .device-input").val(validator.escape(t.storage.device));case"iscsi":return $("#storage-"+t.storage.type+" .ip-input").val(validator.escape(t.storage.ip)),$("#storage-"+t.storage.type+" .target-input").val(validator.escape(t.storage.target)),$("#storage-"+t.storage.type+" .username-input").val(validator.escape(t.storage.username)),$("#storage-"+t.storage.type+" .password-input").val(validator.escape(t.storage.password));case"nbd":return $("#storage-"+t.storage.type+" .ip-input").val(validator.escape(t.storage.ip)),$("#storage-"+t.storage.type+" .port-input").val(validator.escape(t.storage.port)),$("#storage-"+t.storage.type+" .export-input").val(validator.escape(t.storage["export"]))}}})},_=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-support").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-support").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))})},j=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-monitor").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-monitor").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:($(".jido-data-platform-version").html(validator.escape(t.version)),F("1h"))})},k=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-backup").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-backup").show(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),b("backup",function(e){return"running"===e.status?O("backup"):"success"===e.status?($("#backupInfo").show(),$("#jido-button-backup-stop").show(),$("#jido-page-backup pre.backup-status-filesize").html(validator.escape(e.filesize)),$("#jido-page-backup pre.backup-status-sha256").html(validator.escape(e.sha256))):($("#backupInfo").hide(),$("#jido-button-backup-stop").hide())})},y=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-replication").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-replication").show(),R(),W(),c("/api/v1/admin/version",function(e,t){return e?void 0:$(".jido-data-platform-version").html(validator.escape(t.version))}),b("replication",function(e){var t;return e.status&&"running"===e.status&&O("replication"),e.replication?(t=e.replication,e.ssh_fingerprint&&e.ssh_pubkey&&($("#replicationInfo").show(),e.ssh_fingerprint&&$("#jido-page-replication pre.replication-fingerprint").html(validator.escape(e.ssh_fingerprint)),e.ssh_pubkey&&$("#jido-page-replication pre.jido-replication-pubkey").html(validator.escape(e.ssh_pubkey))),t.replication_targets[0].token?($("#replicationTargetApplianceForms").show(),$("#target-type-1").prop("checked",!0),$("#replication-target-appliance").val(validator.escape(t.replication_targets[0].host)),$("#replication-target-token").val(validator.escape(t.replication_targets[0].token))):($("#replicationTargetServerForms").show(),$("#target-type-2").prop("checked",!0),$("#replication-target-host").val(validator.escape(t.replication_targets[0].host)),$("#replication-target-port").val(t.replication_targets[0].port),$("#replication-target-data").val(t.replication_targets[0].data)),"enabled"===t.replication_status?($("#jido-page-replication .replication-status").show(),$("#jido-page-replication .enabledbutton").html('<strong class="fa icon-toggle-on text-success"> enabled</strong>')):($("#jido-page-replication .replication-status").show(),$("#jido-page-replication .enabledbutton").html('<strong class="fa icon-toggle-off text-danger"> disabled</strong>'))):void 0})},F=function(e){var t;return t=function(e){switch(e){case"1h":return d("-1h");case"1d":return d("-1d");case"1w":return d("-1w");case"1m":return d("-1m");case"1y":return d("-1y");default:return d("-1d")}},$("#jido-monitor-duration li").removeClass("active"),$(".jido-duration-"+e).addClass("active"),$("#jido-page-monitor p .jido-monitor-msg").fadeIn(500,function(){return t(e)})},d=function(e){var t;return t="-s "+e,draw("svgload","load",t),draw("svgmemory","memory",t),draw("svgnetwork","if_octets",t),draw("svgdisk","disk",t),$("#jido-page-monitor p .jido-monitor-msg").fadeOut(2e3)},X=function(){return $("#jido-button-update-upload").click(function(){var e;return e=new FormData,e.append("update",$("#update-input[type=file]")[0].files[0]),e?H("update","/api/v1/admin/update",e,function(e,t){return e?void 0:O("update")}):void 0})},N=function(){return $("#jido-button-network-upload").click(function(){var e,t,a,r;if(r=new Object,r.app={},r.network={},r.network.hostname=$("#hostname-input").val(),r.network["interface"]=$("#interface-input").val(),r.network.ip_address=$("#ip_address-input").val(),r.network.netmask=$("#netmask-input").val(),r.network.gateway=$("#gateway-input").val(),r.network.ntpserver=$("#ntpserver-input").val(),$("#dns1-input").val()&&(r.network.dns1=$("#dns1-input").val()),$("#dns2-input").val()&&(r.network.dns2=$("#dns2-input").val()),!r.network.hostname||!validator.isFQDN(r.network.hostname,{require_tld:!1}))return $(".network-form .network-hostname-label").parent().addClass("has-error"),$(".network-form .network-hostname-label").html("Hostname (required)"),void $(".network-form .network-hostname-label").focus();if(!r.network["interface"]||!validator.isAlphanumeric(r.network["interface"]))return $(".network-form .network-interface-label").parent().addClass("has-error"),$(".network-form .network-interface-label").html("Interface (required)"),void $(".network-form .network-interface-label").focus();if(r.network.ntpserver&&!validator.isFQDN(r.network.ntpserver)&&!validator.isIP(r.network.ntpserver))return $(".network-form .network-ntpserver-label").parent().addClass("has-error"),$(".network-form .network-ntpserver-label").html("NTP Server (required)"),void $(".network-form .network-ntpserver-label").focus();if($(".jido-data-network-status").removeClass("label-danger"),$(".jido-data-network-status").removeClass("label-success"),$(".jido-data-network-status").removeClass("label-default"),r.network.ip_address&&r.network.netmask&&r.network.gateway){if(!validator.isIP(r.network.ip_address))return $(".network-form .network-ip_address-label").parent().addClass("has-error"),void $(".network-form .network-ip_address-label").focus();if(!validator.isIP(r.network.netmask)&&!validator.isInt(r.network.netmask.replace("/",""),{min:1,max:128}))return $(".network-form .network-netmask-label").parent().addClass("has-error"),void $(".network-form .network-netmask-label").focus();if(!validator.isIP(r.network.gateway))return $(".network-form .network-gateway-label").parent().addClass("has-error"),void $(".network-form .network-gateway-label").focus();if(r.network.dns1&&!validator.isIP(r.network.dns1))return $(".network-form .network-dns1-label").parent().addClass("has-error"),void $(".network-form .network-dns1-label").focus();if(r.network.dns2&&!validator.isIP(r.network.dns2))return $(".network-form .network-dns2-label").parent().addClass("has-error"),void $(".network-form .network-dns2-label").focus();$(".jido-data-network-status").html("STATIC"),$(".jido-data-network-status").addClass("label-success")}else $(".jido-data-network-status").html("DHCP"),$(".jido-data-network-status").addClass("label-success"),delete r.network.ip_address,delete r.network.netmask,delete r.network.gateway,delete r.network.ntpserver,delete r.network.dns1,delete r.network.dns2;return a=new FormData,t=JSON.stringify(r),e=new Blob([t],{type:"application/json"}),e.lastModifiedDate=new Date,a.append("settings",e,"settings.json"),a?H("network","/api/v1/admin/settings",a,function(e,t){var a,o;return e?void 0:(U("network"),r.network.ip_address?(a=validator.isIP(r.network.ip_address,4)?r.network.ip_address:"["+r.network.ip_address+"]",o=window.location.protocol+"//"+a+(null!=window.location.port?":"+window.location.port:""),$(".network-alert").html('Redirecting to <a href="'+o+'">'+o+"</a> in 5 seconds"),$(".network-alert").show(),Q(o)):w())}):void 0})},i=function(){return $("#jido-button-certs-upload").click(function(){var e;return e=new FormData,e.append("public",$("#public-key-input[type=file]")[0].files[0]),e.append("private",$("#private-key-input[type=file]")[0].files[0]),$("#ca-key-input[type=file]")[0].files[0]&&e.append("ca",$("#ca-key-input[type=file]")[0].files[0]),e?H("certs","/api/v1/admin/certs",e,function(e,t){return e?void 0:O("certs")}):void 0})},Y=function(e){return $("#jido-button-"+e+"-fulllog").click(function(){return c("/api/v1/admin/"+e+"/log",function(t,a){return t?void 0:($("#jido-button-"+e+"-fulllog").addClass("active"),$(".jido-data-"+e+"-full-log").parent().show(),$(".jido-data-"+e+"-full-log").html(a?validator.escape(a):"No log file found"))})})},S=function(){return $("#jido-data-logs-files").click(function(){return u("/api/v1/admin/logs",function(e){})})},l=function(){return $("#jido-data-debug-files").click(function(){return u("/api/v1/admin/debug",function(e){})})},L=function(){return $("#jido-button-restart-confirm").click(function(){return c("/api/v1/admin/reboot",function(e){e||$(".restart-alert").show()})})},x=function(){return $("#jido-monitor-duration li a").click(function(){var e;return e=$(this).attr("duration"),F(e)})},J=function(){return $("#jido-button-storage-upload").click(function(){var e,t,a,r;switch(r=new Object,r.storage={},r.storage.type=$("#storage-name-select").val(),r.storage.type){case"nfs":if(r.storage.ip=$("#storage-"+r.storage.type+" .ip-input").val(),r.storage.mount_options=$("#storage-"+r.storage.type+" .mount-input").val(),r.storage.share=$("#storage-"+r.storage.type+" .share-input").val(),!r.storage.ip||!validator.isIP(r.storage.ip))return $("#storage-"+r.storage.type+" .storage-ip-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-ip-label").html("IP address (required)"),void $("#storage-"+r.storage.type+" .ip-input").focus();if(!r.storage.share||!validator.isWhitelisted(r.storage.share,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"))return $("#storage-"+r.storage.type+" .storage-share-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-share-label").html("Share path (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"),void $("#storage-"+r.storage.type+" .share-input").focus();if(!r.storage.mount_options||!validator.isWhitelisted(r.storage.mount_options,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789=,.-"))return $("#storage-"+r.storage.type+" .storage-mount-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-mount-label").html("Mount options (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789=,.-"),void $("#storage-"+r.storage.type+" .mount-input").focus();break;case"aoe":if(r.storage.device=$("#storage-"+r.storage.type+" .device-input").val(),!r.storage.device||!validator.isWhitelisted(r.storage.device,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789."))return $("#storage-"+r.storage.type+" .storage-device-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-device-label").html("Device (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789."),void $("#storage-"+r.storage.type+" .device-input").focus();break;case"iscsi":if(r.storage.ip=$("#storage-"+r.storage.type+" .ip-input").val(),r.storage.target=$("#storage-"+r.storage.type+" .target-input").val(),r.storage.username=$("#storage-"+r.storage.type+" .username-input").val(),r.storage.password=$("#storage-"+r.storage.type+" .password-input").val(),!r.storage.ip||!validator.isIP(r.storage.ip))return $("#storage-"+r.storage.type+" .storage-ip-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-ip-label").html("IP address (required)"),void $("#storage-"+r.storage.type+" .ip-input").focus();if(!r.storage.target||!validator.isWhitelisted(r.storage.target,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-:"))return $("#storage-"+r.storage.type+" .storage-target-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-target-label").html("Target (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-:"),void $("#storage-"+r.storage.type+" .target-input").focus();if(!r.storage.username||!validator.isAscii(r.storage.username))return $("#storage-"+r.storage.type+" .storage-username-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-username-label").html("Username (required)<br/>Allowed: ASCII characters"),void $("#storage-"+r.storage.type+" .username-input").focus();if(!r.storage.password||!validator.isAscii(r.storage.password))return $("#storage-"+r.storage.type+" .storage-password-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-password-label").html("Password (required)<br/>Allowed: ASCII characters"),void $("#storage-"+r.storage.type+" .password-input").focus();break;case"nbd":if(r.storage.ip=$("#storage-"+r.storage.type+" .ip-input").val(),r.storage.port=$("#storage-"+r.storage.type+" .port-input").val(),r.storage.export_name=$("#storage-"+r.storage.type+" .export-input").val(),!r.storage.ip||!validator.isIP(r.storage.ip))return $("#storage-"+r.storage.type+" .storage-ip-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-ip-label").html("IP address (required)"),void $("#storage-"+r.storage.type+" .ip-input").focus();if(!r.storage.port||!validator.isNumeric(r.storage.port))return $("#storage-"+r.storage.type+" .storage-port-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-port-label").html("Port (required)"),void $("#storage-"+r.storage.type+" .port-input").focus();if(!r.storage.export_name||!validator.isWhitelisted(r.storage.export_name,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"))return $("#storage-"+r.storage.type+" .storage-export-label").parent().addClass("has-error"),$("#storage-"+r.storage.type+" .storage-export-label").html("Export name (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"),void $("#storage-"+r.storage.type+" .export-input").focus()}return a=new FormData,t=JSON.stringify(r),e=new Blob([t],{type:"application/json"}),e.lastModifiedDate=new Date,a.append("settings",e,"settings.json"),a?H("storage","/api/v1/admin/storage",a,function(e,t){return $(".jido-page-content-storage .jido-panel").show(),e?void 0:(U("storage"),$(".storage-alert").html("Please Restart to apply storage settings."),$(".storage-alert").show())}):void 0})},z=function(){return $("#storage-name-select").change(function(){var e;return e=$(this).val(),$(".storage-form-options").hide(),$("#storage-"+e).show()})},o=function(){return $("#jido-button-backup-start").click(function(){var e;return e=new FormData,e.append("action","START"),e?H("backup","/api/v1/admin/backup",e,function(e,t){return $(".backup-alert").html("The backup will complete shortly."),$(".jido-page-content-backup .jido-panel").show(),e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success"),k())}):void 0}),$("#jido-button-backup-stop").click(function(){var e;return e=new FormData,e.append("action","STOP"),e?H("backup","/api/v1/admin/backup",e,function(e,t){return $(".jido-page-content-backup .jido-panel").show(),e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").html("backup canceled"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success"),U("backup"),k())}):void 0}),$("#jido-data-backup-file").click(function(){return u("/api/v1/admin/backup/download",function(e){})}),$("#jido-button-backup-upload").click(function(){var e;return e=new FormData,e.append("archive",$("#backup-restore-input[type=file]")[0].files[0]),e?H("backup","/api/v1/admin/backup/restore",e,function(e,t){return $(".jido-page-content-backup .jido-panel").show(),e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").html("backup restored"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),
$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success")),$(".jido-page-content-backup .progress").hide()}):void 0})},B=function(){return $("#jido-button-replication-upload").click(function(){var e,t,a,r,o,n,i,s;if(r=new Object,r.replication={},r.replication.replication_status="enabled",o=$("#replication-source-input").val(),o&&(r.replication.replication_source_pubkey=o,!validator.isAscii(r.replication.replication_source_pubkey)))return $("#jido-page-replication .replication-source-label").parent().addClass("has-error"),$("#jido-page-replication .replication-source-label p").html("Public SSH key<br/>Allowed: ASCII characters"),void $("#replication-source-input").focus();switch(r.replication.replication_targets=[],r.replication.replication_targets[0]={},i=$("#target-type-1").is(":checked"),s=$("#target-type-2").is(":checked"),n=i===!0?"appliance":"server"){case"appliance":if(r.replication.replication_targets[0].host=$("#replication-target-appliance").val(),r.replication.replication_targets[0].token=$("#replication-target-token").val(),!validator.isFQDN(r.replication.replication_targets[0].host,{require_tld:!1})&&!validator.isIP(r.replication.replication_targets[0].host))return $("#jido-page-replication .replication-target-appliance-label").parent().addClass("has-error"),$("#jido-page-replication .replication-target-appliance-label p").html("Hostname/IP<br/>Allowed: FQDN, IPv4, IPv6"),void $("#replication-target-appliance").focus();if(!(r.replication.replication_targets[0].token.length>0&&r.replication.replication_targets[0].token.length<=255))return $("#jido-page-replication .replication-target-token-label").parent().addClass("has-error"),$("#jido-page-replication .replication-target-token-label p").html("API token<br/>Length: between 1 and 255 characters"),void $("#replication-target-token").focus();break;case"server":if(r.replication.replication_targets[0].host=$("#replication-target-host").val(),r.replication.replication_targets[0].port=$("#replication-target-port").val(),r.replication.replication_targets[0].data=$("#replication-target-data").val(),!validator.isFQDN(r.replication.replication_targets[0].host,{require_tld:!1})&&!validator.isIP(r.replication.replication_targets[0].host))return $("#jido-page-replication .replication-target-host-label").parent().addClass("has-error"),$("#jido-page-replication .replication-target-host-label p").html("Hostname/IP (or username@hostname)<br/>Allowed: FQDN, IPv4, IPv6"),void $("#replication-target-host").focus();if(!(validator.isNumeric(r.replication.replication_targets[0].port)&&r.replication.replication_targets[0].port>=1&&r.replication.replication_targets[0].port<=65535))return $("#jido-page-replication .replication-target-port-label").parent().addClass("has-error"),$("#jido-page-replication .replication-target-port-label p").html("SSH port<br/>Number: between 1 and 65535 characters"),void $("#replication-target-port").focus();if(!validator.isWhitelisted(r.replication.replication_targets[0].data,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"))return $("#jido-page-replication .replication-target-data-label").parent().addClass("has-error"),$("#jido-page-replication .replication-target-data-label p").html("Destination dir<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"),void $("#replication-target-data").focus()}return console.log("REPLICATION: ",r.replication.replication_targets[0]),a=new FormData,t=JSON.stringify(r),e=new Blob([t],{type:"application/json"}),e.lastModifiedDate=new Date,a.append("settings",e,"settings.json"),console.log("FORM:",t)})},K=function(){return $("#target-type-1").change(function(){return $("#replicationTargetServerForms").hide(),$("#replicationTargetApplianceForms").show()}),$("#target-type-2").change(function(){return $("#replicationTargetApplianceForms").hide(),$("#replicationTargetServerForms").show()})},q=function(){return $("#jido-page-navbar .navbar-nav li a").click(function(){var e;switch(e=$(this).parent().attr("id")){case"jido-button-home":h();break;case"jido-button-update":A("update");break;case"jido-button-settings":w();break;case"jido-button-certs":A("certs");break;case"jido-button-license":loadLicense();break;case"jido-button-storage":I();break;case"jido-button-token":P();break;case"jido-button-support":_();break;case"jido-button-monitor":j();break;case"jido-button-backup":k();break;case"jido-button-replication":y()}return R()})},X(),N(),i(),Y("update"),S(),l(),L(),x(),J(),z(),o(),B(),K(),q(),r(function(e){return e?m():y()})}).call(this);
